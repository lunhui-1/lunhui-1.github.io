<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ä¸–ç•Œå…¨ç‰ˆæœ¬æŒ‡ä»¤è¾…åŠ© | è½®å›é“å°˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Noto+Sans+SC:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --mc-green: #5D8C3A;
            --mc-dark-green: #3D6E2E;
            --mc-light-green: #7EB356;
            --mc-orange: #d97706;
            --mc-red: #dc2626;
            --mc-blue: #2563eb;
            --mc-cyan: #06b6d4;
            --mc-gold: #fbbf24;
            --mc-purple: #9333ea;
            --sidebar-width: 280px;
            --bg-dark: #0a0f1c;
            --glass-bg: rgba(20, 25, 40, 0.95);
            --hover-bg: rgba(93, 140, 58, 0.15);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background: var(--bg-dark); 
            color: #e2e8f0; 
            margin: 0; 
            min-height: 100vh;
            overflow-x: hidden;
        }

        .pixel-font { font-family: 'VT323', monospace; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars-bg { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -2;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }

        .particles { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -1; 
            overflow: hidden; 
            pointer-events: none; 
        }

        .particle { 
            position: absolute; 
            width: 2px; 
            height: 2px; 
            background: var(--mc-green); 
            border-radius: 50%; 
            opacity: 0.6; 
            animation: float-up linear infinite; 
            box-shadow: 0 0 10px var(--mc-green);
        }

        @keyframes float-up { 
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 
            10% { opacity: 0.8; } 
            90% { opacity: 0.8; } 
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; } 
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255,255,255,0.08);
            z-index: 100;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            transition: transform 0.3s ease;
        }

        .logo-area {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo-img {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid transparent;
            background: linear-gradient(var(--bg-dark), var(--bg-dark)) padding-box,
                        linear-gradient(135deg, var(--mc-green), var(--mc-gold)) border-box;
            box-shadow: 0 0 15px rgba(93,140,58,0.3);
            animation: logo-glow 3s ease-in-out infinite;
        }

        @keyframes logo-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(93,140,58,0.3); }
            50% { box-shadow: 0 0 25px rgba(93,140,58,0.5); }
        }

        .logo-text h1 {
            font-size: 1.15rem;
            font-weight: 700;
            background: linear-gradient(90deg, #fff, var(--mc-light-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            line-height: 1.2;
        }

        .logo-text span {
            font-size: 0.75rem;
            color: #64748b;
        }

        .nav-container {
            flex: 1;
            padding: 16px 12px;
        }

        .nav-section { margin-bottom: 4px; }

        .nav-parent {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            color: #94a3b8;
            transition: all 0.2s;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .nav-parent:hover {
            background: rgba(255,255,255,0.05);
            color: #fff;
        }

        .nav-parent.active {
            background: var(--hover-bg);
            color: var(--mc-light-green);
        }

        .nav-parent-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-icon {
            width: 22px;
            text-align: center;
            font-size: 1.1rem;
        }

        .expand-icon {
            font-size: 0.8rem;
            transition: transform 0.3s;
        }

        .nav-parent.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .nav-children {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding-left: 8px;
        }

        .nav-parent.expanded + .nav-children {
            max-height: 600px;
        }

        /* äºŒçº§èœå• */
        .nav-child {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px 10px 40px;
            margin: 3px 0;
            border-radius: 8px;
            cursor: pointer;
            color: #94a3b8;
            font-size: 0.9rem;
            transition: all 0.2s;
            position: relative;
        }

        .nav-child::before {
            content: '';
            position: absolute;
            left: 24px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 4px;
            background: currentColor;
            border-radius: 50%;
            opacity: 0.5;
        }

        .nav-child:hover { background: rgba(255,255,255,0.05); color: #fff; }

        .nav-child.active {
            background: rgba(93,140,58,0.2);
            color: var(--mc-light-green);
        }

        .nav-child.active::before { background: var(--mc-light-green); opacity: 1; }

        /* ä¸‰çº§èœå•ï¼ˆç”¨äºçº é”™å­é¡¹ï¼‰ */
        .nav-grandchild {
            display: flex;
            align-items: center;
            padding: 8px 16px 8px 56px;
            margin: 2px 0;
            border-radius: 8px;
            cursor: pointer;
            color: #64748b;
            font-size: 0.85rem;
            transition: all 0.2s;
            position: relative;
        }

        .nav-grandchild::before {
            content: 'â€¢';
            position: absolute;
            left: 40px;
            font-size: 1.2rem;
            opacity: 0.4;
        }

        .nav-grandchild:hover { color: #fff; background: rgba(255,255,255,0.03); }

        .nav-grandchild.active {
            color: var(--mc-gold);
            background: rgba(251,191,36,0.1);
        }

        .nav-badge {
            background: rgba(93,140,58,0.2);
            color: var(--mc-light-green);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .nav-divider {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #64748b;
            padding: 16px 16px 8px;
            font-weight: 600;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid rgba(255,255,255,0.08);
            background: rgba(0,0,0,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .stat-box {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-family: 'VT323', monospace;
            font-size: 1.8rem;
            color: var(--mc-light-green);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #64748b;
            margin-top: 4px;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            padding: 32px;
            transition: margin-left 0.3s;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, #fff, var(--mc-light-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-subtitle {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 4px;
        }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-card {
            background: linear-gradient(135deg, rgba(30,41,59,0.6), rgba(15,23,42,0.6));
            border: 2px dashed rgba(93,140,58,0.3);
            border-radius: 20px;
            padding: 48px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 32px;
        }

        .upload-card:hover {
            border-color: var(--mc-green);
            background: rgba(93,140,58,0.05);
            transform: translateY(-2px);
        }

        .upload-card.dragover {
            border-color: var(--mc-gold);
            background: rgba(251,191,36,0.1);
        }

        /* è¾“å…¥æ¡†åŒºåŸŸï¼ˆæ‰‹æœºç«¯/è¯­æ³•è½¬æ¢ç”¨ï¼‰ */
        .input-area {
            background: rgba(30,41,59,0.6);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .command-textarea {
            width: 100%;
            min-height: 200px;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px;
            color: #e2e8f0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s;
        }

        .command-textarea:focus {
            outline: none;
            border-color: var(--mc-green);
            box-shadow: 0 0 0 3px rgba(93,140,58,0.1);
        }

        .command-textarea.error {
            border-color: var(--mc-red);
            background: rgba(220,38,38,0.1);
        }

        .command-textarea.success {
            border-color: var(--mc-green);
            background: rgba(93,140,58,0.1);
        }

        /* æŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--mc-green), var(--mc-dark-green));
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(93,140,58,0.3);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e2e8f0;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--mc-gold), #f59e0b);
            color: #000;
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251,191,36,0.3);
        }

        /* æœç´¢æ¡† */
        .search-box {
            position: relative;
            margin-bottom: 24px;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px;
            background: rgba(30,41,59,0.6);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--mc-green);
            box-shadow: 0 0 0 3px rgba(93,140,58,0.1);
        }

        /* ç­›é€‰æ ‡ç­¾ */
        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 24px;
        }

        .chip {
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #cbd5e1;
        }

        .chip:hover {
            background: rgba(93,140,58,0.1);
            border-color: rgba(93,140,58,0.3);
        }

        .chip.active {
            background: linear-gradient(135deg, var(--mc-green), var(--mc-dark-green));
            border-color: transparent;
            color: #fff;
        }

        /* å†…å®¹ç½‘æ ¼ */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 20px;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: linear-gradient(135deg, rgba(30,41,59,0.8), rgba(15,23,42,0.9));
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--mc-green), var(--mc-gold));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover {
            transform: translateY(-4px);
            border-color: rgba(93,140,58,0.4);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .card:hover::before { opacity: 1; }

        .card-cmd { border-top: 3px solid var(--mc-green); }
        .card-block { border-top: 3px solid var(--mc-orange); }
        .card-redstone { border-top: 3px solid var(--mc-red); }
        .card-item { border-top: 3px solid var(--mc-blue); }
        .card-adv { border-top: 3px solid var(--mc-cyan); }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .card-title {
            font-family: 'VT323', monospace;
            font-size: 1.6rem;
            color: #fff;
            margin: 0;
            line-height: 1.2;
        }

        .card-version {
            font-size: 0.75rem;
            color: #64748b;
            background: rgba(0,0,0,0.3);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
        }

        .card-desc {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .card-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            padding: 4px 10px;
            background: rgba(93,140,58,0.2);
            color: var(--mc-light-green);
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .tag-red { background: rgba(220,38,38,0.2); color: #fca5a5; }
        .tag-blue { background: rgba(37,99,235,0.2); color: #60a5fa; }
        .tag-cyan { background: rgba(6,182,212,0.2); color: #22d3ee; }
        .tag-orange { background: rgba(217,119,6,0.2); color: #fbbf24; }
        .tag-purple { background: rgba(147,51,234,0.2); color: #c084fc; }
        .tag-gold { background: rgba(251,191,36,0.2); color: #fbbf24; }

        /* IDå— */
        .id-block {
            background: rgba(0,0,0,0.4);
            padding: 10px 14px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--mc-gold);
            border: 1px solid rgba(251,191,36,0.3);
            margin-top: 12px;
            cursor: pointer;
            transition: all 0.2s;
            word-break: break-all;
        }

        .id-block:hover {
            border-color: var(--mc-gold);
            background: rgba(251,191,36,0.1);
        }

        /* è¯­æ³•è½¬æ¢ç»“æœå±•ç¤º */
        .result-panel {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .result-title {
            font-weight: 600;
            color: var(--mc-light-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-stats {
            display: flex;
            gap: 16px;
            font-size: 0.85rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-item.success { color: var(--mc-light-green); }
        .stat-item.error { color: var(--mc-red); }
        .stat-item.warning { color: var(--mc-gold); }

        /* ä»£ç å¯¹æ¯”è¡Œ */
        .diff-line {
            display: grid;
            grid-template-columns: 30px 1fr;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.03);
            border-left: 3px solid transparent;
        }

        .diff-line.modified {
            border-left-color: var(--mc-gold);
            background: rgba(251,191,36,0.05);
        }

        .diff-line.error {
            border-left-color: var(--mc-red);
            background: rgba(220,38,38,0.05);
        }

        .diff-line.success {
            border-left-color: var(--mc-green);
            background: rgba(93,140,58,0.05);
        }

        .diff-line-number {
            color: #64748b;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            text-align: right;
        }

        .diff-content {
            overflow-x: auto;
        }

        .diff-original {
            color: #94a3b8;
            text-decoration: line-through;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .diff-converted {
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .diff-error {
            color: var(--mc-red);
            font-size: 0.85rem;
            margin-top: 4px;
        }

        .diff-warning {
            color: var(--mc-gold);
            font-size: 0.85rem;
            margin-top: 4px;
        }

        /* é”™è¯¯æŠ¥å‘Šæ ·å¼ */
        .error-report {
            background: rgba(220,38,38,0.1);
            border: 1px solid rgba(220,38,38,0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .error-report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .error-type {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .error-type.critical { background: rgba(220,38,38,0.3); color: #fca5a5; }
        .error-type.warning { background: rgba(217,119,6,0.3); color: #fbbf24; }
        .error-type.info { background: rgba(6,182,212,0.3); color: #22d3ee; }

        /* ç‰ˆæœ¬èŒƒå›´æ ‡ç­¾ */
        .version-range {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 8px;
        }

        .version-range i { color: var(--mc-green); }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
            color: #64748b;
            background: rgba(30,41,59,0.3);
            border-radius: 16px;
            border: 2px dashed rgba(255,255,255,0.1);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            z-index: 200;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30,41,59,0.98), rgba(15,23,42,0.98));
            border: 1px solid rgba(93,140,58,0.3);
            border-radius: 24px;
            max-width: 800px;
            margin: 40px auto;
            padding: 32px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(220,38,38,0.2);
            color: #fff;
            transform: rotate(90deg);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, var(--mc-green), var(--mc-dark-green));
            color: #fff;
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: 500;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ç§»åŠ¨ç«¯èœå•æŒ‰é’® */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 99;
            width: 44px;
            height: 44px;
            background: var(--glass-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        /* é®ç½© */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 90;
            backdrop-filter: blur(4px);
        }

        /* é€‰é¡¹å¡ç»„ */
        .tab-group {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 16px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--mc-green), var(--mc-dark-green));
            border-color: transparent;
            color: #fff;
        }

        /* éšè—/æ˜¾ç¤ºç±» */
        .mobile-only { display: none; }
        .desktop-only { display: block; }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--mc-green), var(--mc-gold));
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* åˆ†ç±»æ ‡ç­¾ç‰¹æ®Šæ ·å¼ */
        .category-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 6px;
        }

        .cat-main { background: rgba(234,179,8,0.2); color: #facc15; }
        .cat-nether { background: rgba(220,38,38,0.2); color: #f87171; }
        .cat-end { background: rgba(147,51,234,0.2); color: #c084fc; }
        .cat-adventure { background: rgba(6,182,212,0.2); color: #22d3ee; }
        .cat-husbandry { background: rgba(34,197,94,0.2); color: #4ade80; }

        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content {
                margin-left: 0;
                padding: 80px 20px 20px;
            }
            .mobile-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .overlay.show { display: block; }
            .desktop-only { display: none !important; }
            .mobile-only { display: block !important; }
            .content-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 640px) {
            .action-buttons { flex-direction: column; }
            .action-buttons .btn { width: 100%; justify-content: center; }
            .tab-group { flex-wrap: wrap; }
            .tab-btn { flex: 1; min-width: 100px; }
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb {
            background: var(--mc-green);
            border-radius: 3px;
        }
    </style>
<base target="_blank">
</head>
<body>
    <div class="stars-bg"></div>
    <div class="particles" id="particles"></div>

    <button class="mobile-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar" id="sidebar">
        <!-- LogoåŒºåŸŸ -->
        <div class="logo-area">
            <img src="image.png" alt="Logo" class="logo-img" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Crect fill=%22%235D8C3A%22 width=%22100%22 height=%22100%22 rx=%2210%22/%3E%3Ctext x=%2250%22 y=%2265%22 font-size=%2250%22 text-anchor=%22middle%22 fill=%22white%22%3EMC%3C/text%3E%3C/svg%3E'">
            <div class="logo-text">
                <h1>MCæŒ‡ä»¤è¾…åŠ©</h1>
                <span>v 1.16.0 data</span><br>
                <span>è½®å›é“å°˜ç²¾å¿ƒåˆ¶ä½œ</span>
            </div>
        </div>

        <!-- å¯¼èˆªèœå• -->
        <nav class="nav-container">
            <!-- æ•°æ®åˆ†ç±»ç»„ -->
            <div class="nav-divider">æ•°æ®åˆ†ç±»</div>

            <!-- ä¸»é¡µï¼ˆå¯å±•å¼€ï¼‰ -->
            <div class="nav-section">
                <div class="nav-parent expanded" onclick="toggleMenu(this)" data-menu="home">
                    <div class="nav-parent-left">
                        <span class="nav-icon"><i class="fas fa-home"></i></span>
                        <span>ä¸»é¡µ</span>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="nav-children" style="max-height: 500px;">
                    <div class="nav-child active" onclick="switchTab('commands', this)">
                        <span>æŒ‡ä»¤å¤§å…¨</span>
                        <span class="nav-badge" id="badge-cmd">0</span>
                    </div>
                    <div class="nav-child" onclick="switchTab('blocks', this)">
                        <span>å‘½ä»¤æ–¹å—</span>
                        <span class="nav-badge" id="badge-block">0</span>
                    </div>
                    <div class="nav-child" onclick="switchTab('redstone', this)">
                        <span>çº¢çŸ³å…ƒä»¶</span>
                        <span class="nav-badge" id="badge-redstone">0</span>
                    </div>
                    <div class="nav-child" onclick="switchTab('items', this)">
                        <span>ç‰©å“ID</span>
                        <span class="nav-badge" id="badge-item">0</span>
                    </div>
                    <div class="nav-child" onclick="switchTab('advancements', this)">
                        <span>å‡†åˆ™ID</span>
                        <span class="nav-badge" id="badge-adv">0</span>
                    </div>
                </div>
            </div>

            <!-- è¯­æ³•ï¼ˆä¸€çº§èœå•ï¼‰ -->
            <div class="nav-section">
                <div class="nav-parent" onclick="toggleMenu(this)" data-menu="grammar">
                    <div class="nav-parent-left">
                        <span class="nav-icon"><i class="fas fa-code"></i></span>
                        <span>è¯­æ³•</span>
                    </div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
                <div class="nav-children">
                    <!-- è½¬æ¢ -->
                    <div class="nav-child" onclick="toggleSubMenu(this, 'convert'); switchGrammarTab('convert-java', this)">
                        <span>è½¬æ¢</span>
                        <i class="fas fa-chevron-right expand-icon" style="font-size: 0.7rem;"></i>
                    </div>
                    <div class="nav-grandchild" data-parent="convert" onclick="switchGrammarTab('convert-java', this)" style="display:none;">
                        <span>Javaç‰ˆ</span>
                    </div>
                    <div class="nav-grandchild" data-parent="convert" onclick="switchGrammarTab('convert-bedrock', this)" style="display:none;">
                        <span>åŸºå²©ç‰ˆ</span>
                    </div>

                    <!-- çº é”™ -->
                    <div class="nav-child" onclick="toggleSubMenu(this, 'fix'); switchGrammarTab('fix-java', this)">
                        <span>çº é”™</span>
                        <i class="fas fa-chevron-right expand-icon" style="font-size: 0.7rem;"></i>
                    </div>
                    <div class="nav-grandchild" data-parent="fix" onclick="switchGrammarTab('fix-java', this)" style="display:none;">
                        <span>Javaç‰ˆ</span>
                    </div>
                    <div class="nav-grandchild" data-parent="fix" onclick="switchGrammarTab('fix-bedrock', this)" style="display:none;">
                        <span>åŸºå²©ç‰ˆ</span>
                    </div>
                    <div class="nav-grandchild" data-parent="fix" onclick="switchGrammarTab('fix-netease', this)" style="display:none;">
                        <span>ç½‘æ˜“ç‰ˆ</span>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œç»„ -->
            <div class="nav-divider">æ“ä½œ</div>

            <div class="nav-parent" onclick="selectFiles()">
                <div class="nav-parent-left">
                    <span class="nav-icon"><i class="fas fa-upload"></i></span>
                    <span>å¯¼å…¥æ•°æ®</span>
                </div>
            </div>

            <div class="nav-parent" onclick="clearAllData()">
                <div class="nav-parent-left">
                    <span class="nav-icon"><i class="fas fa-trash-alt"></i></span>
                    <span>æ¸…ç©ºæ•°æ®</span>
                </div>
            </div>
        </nav>

        <!-- åº•éƒ¨ç»Ÿè®¡ -->
        <div class="sidebar-footer">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">æ€»æ•°æ®</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-cmd">0</div>
                    <div class="stat-label">æŒ‡ä»¤</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- ä¸»å†…å®¹ -->
    <main class="main-content" id="main-content">
        <!-- åŠ¨æ€å†…å®¹å°†ç”±JavaScriptæ¸²æŸ“ -->
    </main>

    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
    // ==================== æ•°æ®å­˜å‚¨ ====================
    const STORAGE_KEY = 'mc_command_helper_data_v116';

    const data = {
        commands: new Map(),
        blocks: [],
        redstone: [],
        items: [],
        advancements: []
    };

    let currentTab = 'commands';
    let currentGrammarTab = '';
    let currentFilter = 'all';
    let processedFiles = new Set();

    // è½¬æ¢å™¨çŠ¶æ€
    const converterState = {
        java: { input: '', output: '', stats: { total: 0, converted: 0, errors: 0 } },
        bedrock: { input: '', output: '', stats: { total: 0, converted: 0, errors: 0 } }
    };

    // çº é”™å™¨çŠ¶æ€
    const fixerState = {
        java: { input: '', reports: [] },
        bedrock: { input: '', reports: [] },
        netease: { input: '', reports: [] }
    };

    const tabNames = {
        commands: 'æŒ‡ä»¤å¤§å…¨',
        blocks: 'å‘½ä»¤æ–¹å—',
        redstone: 'çº¢çŸ³å…ƒä»¶',
        items: 'ç‰©å“ID',
        advancements: 'å‡†åˆ™ID',
        'convert-java': 'Javaç‰ˆè¯­æ³•è½¬æ¢',
        'convert-bedrock': 'åŸºå²©ç‰ˆè¯­æ³•è½¬æ¢',
        'fix-java': 'Javaç‰ˆæŒ‡ä»¤çº é”™',
        'fix-bedrock': 'åŸºå²©ç‰ˆæŒ‡ä»¤çº é”™',
        'fix-netease': 'ç½‘æ˜“ç‰ˆæŒ‡ä»¤çº é”™'
    };

    const versionMap = {
        'java': 'Javaç‰ˆ',
        'bedrock': 'åŸºå²©ç‰ˆ',
        'education': 'æ•™è‚²ç‰ˆ',
        'edu': 'æ•™è‚²ç‰ˆ',
        'netease': 'ç½‘æ˜“ç‰ˆ'
    };

    const categoryMap = {
        'ä¸»çº¿æ•…äº‹': 'ä¸»çº¿æ•…äº‹',
        'ä¸‹ç•Œ': 'ä¸‹ç•Œ',
        'ä¸‹ç•Œå‡†åˆ™': 'ä¸‹ç•Œ',
        'æœ«åœ°': 'æœ«åœ°',
        'æœ«åœ°å‡†åˆ™': 'æœ«åœ°',
        'å†’é™©': 'å†’é™©',
        'å†’é™©å‡†åˆ™': 'å†’é™©',
        'å†œç‰§ä¸š': 'å†œç‰§ä¸š',
        'å†œç‰§ä¸šå‡†åˆ™': 'å†œç‰§ä¸š'
    };

    // ==================== åˆå§‹åŒ– ====================
    window.onload = function() {
        initParticles();
        loadFromStorage();
        renderMainContent();
    };

    function initParticles() {
        const container = document.getElementById('particles');
        for(let i = 0; i < 40; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = Math.random() * 100 + '%';
            p.style.animationDelay = Math.random() * 15 + 's';
            p.style.animationDuration = (10 + Math.random() * 20) + 's';
            container.appendChild(p);
        }
    }

    // ==================== å­˜å‚¨ç®¡ç† ====================
    function loadFromStorage() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if(saved) {
                const parsed = JSON.parse(saved);
                if(parsed.commands) parsed.commands.forEach(([k,v]) => data.commands.set(k,v));
                if(parsed.blocks) data.blocks = parsed.blocks;
                if(parsed.redstone) data.redstone = parsed.redstone;
                if(parsed.items) data.items = parsed.items;
                if(parsed.advancements) data.advancements = parsed.advancements;
                if(parsed.processedFiles) processedFiles = new Set(parsed.processedFiles);
                updateStats();
            }
        } catch(e) { console.error('åŠ è½½æ•°æ®å¤±è´¥:', e); }
    }

    function saveToStorage() {
        try {
            const saveData = {
                commands: Array.from(data.commands.entries()),
                blocks: data.blocks,
                redstone: data.redstone,
                items: data.items,
                advancements: data.advancements,
                processedFiles: Array.from(processedFiles)
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData));
        } catch(e) { console.error('ä¿å­˜æ•°æ®å¤±è´¥:', e); }
    }

    // ==================== å¯¼èˆªæ§åˆ¶ ====================
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
        document.getElementById('overlay').classList.toggle('show');
    }

    function toggleMenu(element) {
        element.classList.toggle('expanded');
        const children = element.nextElementSibling;
        children.style.maxHeight = element.classList.contains('expanded') ? '600px' : '0';
    }

    function toggleSubMenu(element, parentId) {
        // åˆ‡æ¢ä¸‰çº§èœå•æ˜¾ç¤º
        const grandchildren = document.querySelectorAll(`[data-parent="${parentId}"]`);
        const isExpanded = element.classList.contains('sub-expanded');

        // å…³é—­å…¶ä»–åŒçº§èœå•
        document.querySelectorAll('.nav-child').forEach(el => {
            if(el !== element) el.classList.remove('sub-expanded');
        });
        document.querySelectorAll('.nav-grandchild').forEach(el => {
            if(el.dataset.parent !== parentId) el.style.display = 'none';
        });

        grandchildren.forEach(el => {
            el.style.display = isExpanded ? 'none' : 'block';
        });
        element.classList.toggle('sub-expanded');
    }

    function switchTab(tab, element) {
        currentTab = tab;
        currentGrammarTab = '';
        currentFilter = 'all';

        // æ›´æ–°å¯¼èˆªçŠ¶æ€
        document.querySelectorAll('.nav-child, .nav-grandchild').forEach(el => el.classList.remove('active'));
        if(element) element.classList.add('active');

        // ç§»åŠ¨ç«¯å…³é—­ä¾§è¾¹æ 
        if(window.innerWidth <= 1024) toggleSidebar();

        renderMainContent();
    }

    function switchGrammarTab(tab, element) {
        currentTab = 'grammar';
        currentGrammarTab = tab;

        // æ›´æ–°å¯¼èˆªçŠ¶æ€
        document.querySelectorAll('.nav-child, .nav-grandchild').forEach(el => el.classList.remove('active'));
        if(element) element.classList.add('active');

        // ç¡®ä¿çˆ¶èœå•å±•å¼€
        const parentNav = element?.closest('.nav-children')?.previousElementSibling;
        if(parentNav && !parentNav.classList.contains('expanded')) {
            toggleMenu(parentNav);
        }

        if(window.innerWidth <= 1024) toggleSidebar();
        renderMainContent();
    }

    // ==================== ä¸»å†…å®¹æ¸²æŸ“ ====================
    function renderMainContent() {
        const container = document.getElementById('main-content');

        if(currentTab === 'grammar' && currentGrammarTab) {
            if(currentGrammarTab.startsWith('convert-')) {
                renderConverterPage(container);
            } else if(currentGrammarTab.startsWith('fix-')) {
                renderFixerPage(container);
            }
        } else {
            renderDatabasePage(container);
        }
    }

    // ==================== æ•°æ®åº“é¡µé¢ ====================
    function renderDatabasePage(container) {
        const title = tabNames[currentTab] || 'æŒ‡ä»¤å¤§å…¨';

        let content = `
        <div class="page-header">
            <div>
                <h2 class="page-title">${title}</h2>
                <div class="page-subtitle">ç®¡ç†å’ŒæŸ¥è¯¢æ¸¸æˆæ•°æ®</div>
            </div>
            <div style="display: flex; gap: 12px;">
                <button onclick="selectFiles()" class="btn btn-secondary">
                    <i class="fas fa-folder-open"></i>å¯¼å…¥
                </button>
                <button onclick="clearAllData()" class="btn" style="background: rgba(220,38,38,0.2); color: #fca5a5;">
                    <i class="fas fa-eraser"></i>æ¸…ç©º
                </button>
            </div>
        </div>

        <div class="upload-card" id="dropZone" onclick="selectFiles()">
            <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ“¦</div>
            <h3 style="font-size: 1.25rem; margin-bottom: 8px; font-weight: 600;">æ‹–æ‹½æ–‡ä»¶æˆ–ZIPåˆ°æ­¤å¤„</h3>
            <p style="color: #64748b; font-size: 0.9rem;">æ”¯æŒ .txt æˆ–åŒ…å«å¤šä¸ªtxtçš„ .zip æ–‡ä»¶</p>
            <input type="file" id="fileInput" multiple accept=".txt,.zip" style="display: none;">
        </div>

        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢..." oninput="handleSearch()">
        </div>

        <div class="filter-chips" id="filters"></div>

        <div id="mainContent" class="content-grid">
            <div class="empty-state">
                <div style="font-size: 4rem; margin-bottom: 16px; opacity: 0.5;">ğŸ“­</div>
                <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 8px; color: #94a3b8;">æš‚æ— æ•°æ®</div>
                <div style="font-size: 0.9rem; color: #64748b;">è¯·ä¸Šä¼ æ–‡ä»¶å¼€å§‹ä½¿ç”¨</div>
            </div>
        </div>`;

        container.innerHTML = content;

        // æ¢å¤æ•°æ®æ¸²æŸ“
        updateFilters();
        renderContent();
        setupDragDrop();
    }

    // ==================== è½¬æ¢å™¨é¡µé¢ ====================
    function renderConverterPage(container) {
        const platform = currentGrammarTab.split('-')[1]; // java or bedrock
        const state = converterState[platform];
        const isJava = platform === 'java';

        let content = `
        <div class="page-header">
            <div>
                <h2 class="page-title">${tabNames[currentGrammarTab]}</h2>
                <div class="page-subtitle">${isJava ? 'å°†æ—§ç‰ˆexecuteè¯­æ³•è½¬æ¢ä¸º1.13+æ–°è¯­æ³•' : 'å°†æ—§ç‰ˆexecuteè¯­æ³•è½¬æ¢ä¸ºåŸºå²©ç‰ˆæ–°è¯­æ³•'}</div>
            </div>
            <div style="display: flex; gap: 12px;">
                <button onclick="downloadResult('${platform}')" class="btn btn-gold" ${!state.output ? 'disabled style="opacity:0.5;"' : ''}>
                    <i class="fas fa-download"></i>ä¸‹è½½ç»“æœ
                </button>
            </div>
        </div>

        <!-- æ‰‹æœºç«¯ï¼šæ˜¾ç¤ºè¾“å…¥æ¡† -->
        <div class="mobile-only input-area">
            <div style="margin-bottom: 12px; color: #64748b; font-size: 0.9rem;">
                <i class="fas fa-mobile-alt"></i> æ‰‹æœºæ¨¡å¼ï¼šç›´æ¥è¾“å…¥æŒ‡ä»¤
            </div>
            <textarea class="command-textarea" id="mobileInput-${platform}" 
                placeholder="${isJava ? '/execute @p ~ ~ ~ say ä½ å¥½&#10;/execute @e[type=zombie] ~ ~ ~ kill' : '/execute @p ~ ~ ~ say ä½ å¥½'}">${state.input}</textarea>
            <div class="action-buttons">
                <button onclick="convertCommands('${platform}', 'mobile')" class="btn btn-primary">
                    <i class="fas fa-exchange-alt"></i>è½¬æ¢è¯­æ³•
                </button>
                <button onclick="clearConverter('${platform}')" class="btn btn-secondary">
                    <i class="fas fa-trash"></i>æ¸…ç©º
                </button>
            </div>
        </div>

        <!-- ç”µè„‘ç«¯ï¼šæ˜¾ç¤ºæ‹–æ”¾åŒºåŸŸ -->
        <div class="desktop-only">
            <div class="upload-card" id="convertDropZone-${platform}" style="margin-bottom: 24px;">
                <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ“</div>
                <h3 style="font-size: 1.25rem; margin-bottom: 8px; font-weight: 600;">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„</h3>
                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 8px;">æ”¯æŒ .txt / .mcfunction / .zip</p>
                <p style="color: #64748b; font-size: 0.8rem;">è‡ªåŠ¨è§£åŒ…å¹¶é€è¡Œå¤„ç†</p>
                <input type="file" id="convertFile-${platform}" multiple accept=".txt,.mcfunction,.zip" style="display: none;">
            </div>
        </div>

        <!-- ç»“æœå±•ç¤º -->
        <div id="convertResult-${platform}">
            ${state.output ? renderConverterResult(platform) : ''}
        </div>`;

        container.innerHTML = content;
        setupConverterDragDrop(platform);
    }

    function renderConverterResult(platform) {
        const state = converterState[platform];
        const lines = state.output.split('\n').filter(l => l.trim());

        return `
        <div class="result-panel">
            <div class="result-header">
                <div class="result-title">
                    <i class="fas fa-check-circle"></i>
                    è½¬æ¢ç»“æœ
                </div>
                <div class="result-stats">
                    <div class="stat-item success">
                        <i class="fas fa-check"></i>
                        <span>${state.stats.converted} æˆåŠŸ</span>
                    </div>
                    ${state.stats.errors > 0 ? `
                    <div class="stat-item error">
                        <i class="fas fa-times"></i>
                        <span>${state.stats.errors} é”™è¯¯</span>
                    </div>` : ''}
                    <div class="stat-item">
                        <i class="fas fa-file-code"></i>
                        <span>${state.stats.total} æ€»è¡Œæ•°</span>
                    </div>
                </div>
            </div>
            <div style="max-height: 600px; overflow-y: auto;">
                ${lines.map((line, idx) => {
                    const orig = state.input.split('\n')[idx] || '';
                    const isError = line.startsWith('# é”™è¯¯');
                    const isComment = orig.trim().startsWith('#') || orig.trim() === '';
                    const isModified = orig !== line && !isComment && !isError;

                    let cssClass = '';
                    if(isError) cssClass = 'error';
                    else if(isModified) cssClass = 'modified';
                    else cssClass = 'success';

                    return `
                    <div class="diff-line ${cssClass}">
                        <div class="diff-line-number">${idx + 1}</div>
                        <div class="diff-content">
                            ${isModified ? `<div class="diff-original">${escapeHtml(orig)}</div>` : ''}
                            <div class="diff-converted">${escapeHtml(line)}</div>
                        </div>
                    </div>`;
                }).join('')}
            </div>
        </div>`;
    }

    // ==================== çº é”™å™¨é¡µé¢ ====================
    function renderFixerPage(container) {
        const platform = currentGrammarTab.split('-')[1]; // java, bedrock, or netease
        const state = fixerState[platform];
        const platformNames = { java: 'Javaç‰ˆ', bedrock: 'åŸºå²©ç‰ˆ', netease: 'ç½‘æ˜“ç‰ˆ' };

        let content = `
        <div class="page-header">
            <div>
                <h2 class="page-title">${tabNames[currentGrammarTab]}</h2>
                <div class="page-subtitle">æ£€æµ‹å¹¶ä¿®å¤æŒ‡ä»¤è¯­æ³•é”™è¯¯ï¼Œæä¾›æ›´äººæ€§åŒ–çš„é”™è¯¯æŠ¥å‘Š</div>
            </div>
        </div>

        <!-- æ‰‹æœºç«¯è¾“å…¥ -->
        <div class="mobile-only input-area">
            <textarea class="command-textarea" id="fixInput-${platform}" 
                placeholder="è¾“å…¥éœ€è¦æ£€æµ‹çš„${platformNames[platform]}æŒ‡ä»¤..."></textarea>
            <div class="action-buttons">
                <button onclick="checkSyntax('${platform}', 'mobile')" class="btn btn-primary">
                    <i class="fas fa-bug"></i>æ£€æµ‹è¯­æ³•
                </button>
                <button onclick="autoFix('${platform}')" class="btn btn-gold">
                    <i class="fas fa-magic"></i>è‡ªåŠ¨ä¿®å¤
                </button>
                <button onclick="clearFixer('${platform}')" class="btn btn-secondary">
                    <i class="fas fa-trash"></i>æ¸…ç©º
                </button>
            </div>
        </div>

        <!-- ç”µè„‘ç«¯æ‹–æ”¾ -->
        <div class="desktop-only">
            <div class="upload-card" id="fixDropZone-${platform}" style="margin-bottom: 24px;">
                <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ”</div>
                <h3 style="font-size: 1.25rem; margin-bottom: 8px; font-weight: 600;">æ‹–æ”¾æ–‡ä»¶è¿›è¡Œæ£€æµ‹</h3>
                <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 8px;">æ”¯æŒ .txt / .mcfunction / .zip</p>
                <p style="color: #64748b; font-size: 0.8rem;">è‡ªåŠ¨è¯†åˆ«è¯­æ³•é”™è¯¯å¹¶æä¾›ä¿®å¤å»ºè®®</p>
                <input type="file" id="fixFile-${platform}" multiple accept=".txt,.mcfunction,.zip" style="display: none;">
            </div>
        </div>

        <!-- ç»“æœåŒºåŸŸ -->
        <div id="fixResult-${platform}">
            ${state.reports.length > 0 ? renderFixerResult(platform) : renderFixerPlaceholder(platform)}
        </div>`;

        container.innerHTML = content;
        setupFixerDragDrop(platform);
    }

    function renderFixerPlaceholder(platform) {
        const platformNames = { java: 'Javaç‰ˆ', bedrock: 'åŸºå²©ç‰ˆ', netease: 'ç½‘æ˜“ç‰ˆ' };
        return `
        <div class="empty-state">
            <div style="font-size: 4rem; margin-bottom: 16px; opacity: 0.5;">ğŸ”</div>
            <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 8px; color: #94a3b8;">${platformNames[platform]}è¯­æ³•æ£€æµ‹</div>
            <div style="font-size: 0.9rem; color: #64748b;">
                ${platform === 'java' ? 'æ”¯æŒå…¨æŒ‡ä»¤è¯­æ³•çº é”™ï¼ŒåŒ…æ‹¬executeè½¬æ¢ã€NBTæ ‡ç­¾æ£€æŸ¥ã€é€‰æ‹©å™¨è¯­æ³•éªŒè¯ç­‰' : 
                  platform === 'bedrock' ? 'åŸºå²©ç‰ˆåŸºç¡€è¯­æ³•æ£€æŸ¥ï¼ŒæŒç»­å®Œå–„ä¸­' : 
                  'ç½‘æ˜“ç‰ˆæŒ‡ä»¤æ£€æŸ¥ï¼ˆåŸºäºåŸºå²©ç‰ˆï¼‰ï¼Œæ”¯æŒä¸­æ–‡åˆ«åæ£€æµ‹'}
            </div>
        </div>`;
    }

    function renderFixerResult(platform) {
        const state = fixerState[platform];
        const critical = state.reports.filter(r => r.severity === 'critical').length;
        const warnings = state.reports.filter(r => r.severity === 'warning').length;

        return `
        <div class="result-panel">
            <div class="result-header">
                <div class="result-title">
                    <i class="fas fa-clipboard-check"></i>
                    æ£€æµ‹æŠ¥å‘Š
                </div>
                <div class="result-stats">
                    ${critical > 0 ? `
                    <div class="stat-item error">
                        <i class="fas fa-times-circle"></i>
                        <span>${critical} ä¸¥é‡é”™è¯¯</span>
                    </div>` : ''}
                    ${warnings > 0 ? `
                    <div class="stat-item warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>${warnings} è­¦å‘Š</span>
                    </div>` : ''}
                    <div class="stat-item success">
                        <i class="fas fa-check-circle"></i>
                        <span>${state.reports.length} é¡¹æ£€æµ‹</span>
                    </div>
                </div>
            </div>

            <div style="max-height: 600px; overflow-y: auto;">
                ${state.reports.map((report, idx) => `
                    <div class="error-report" style="${idx > 0 ? 'margin-top: 12px;' : ''}">
                        <div class="error-report-header">
                            <div>
                                <span class="error-type ${report.severity}">
                                    <i class="fas fa-${report.severity === 'critical' ? 'times-circle' : report.severity === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                                    ${report.type}
                                </span>
                                <span style="color: #64748b; margin-left: 12px; font-size: 0.85rem;">ç¬¬ ${report.line} è¡Œ</span>
                            </div>
                            <button onclick="copyText('${report.suggestion}')" class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;">
                                <i class="fas fa-copy"></i>å¤åˆ¶ä¿®å¤
                            </button>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; margin-bottom: 12px; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
                            <div style="color: #94a3b8; text-decoration: line-through;">${escapeHtml(report.original)}</div>
                        </div>
                        <div style="color: #e2e8f0; margin-bottom: 8px;">
                            <strong>é—®é¢˜ï¼š</strong>${report.message}
                        </div>
                        <div style="color: var(--mc-light-green);">
                            <strong>å»ºè®®ï¼š</strong>${report.suggestion}
                        </div>
                        ${report.docs ? `<div style="margin-top: 8px; font-size: 0.8rem; color: #64748b;">
                            <i class="fas fa-book"></i> å‚è€ƒï¼š<a href="${report.docs}" target="_blank" style="color: var(--mc-cyan);">Minecraft Wiki</a>
                        </div>` : ''}
                    </div>
                `).join('')}
            </div>
        </div>`;
    }

    // ==================== Javaç‰ˆæ—§executeè½¬æ¢æ ¸å¿ƒ ====================
    function convertJavaExecute(line) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯æ—§ç‰ˆexecute
        if(!line.trim().startsWith('/execute') && !line.trim().startsWith('execute')) return line;

        const trimmed = line.trim();
        const parts = trimmed.split(/\s+/);

        // å·²ç»æ˜¯æ–°è¯­æ³•
        if(parts.includes('as') || parts.includes('at') || parts.includes('run')) return line;

        // æ—§è¯­æ³•ï¼š/execute <target> <x> <y> <z> <command>
        // æˆ– /execute <target> <x> <y> <z> detect <x> <y> <z> <block> <data> <command>

        try {
            let idx = parts[0] === '/execute' || parts[0] === 'execute' ? 1 : 0;
            if(idx >= parts.length) return line;

            const target = parts[idx++];
            const x = parts[idx++];
            const y = parts[idx++];
            const z = parts[idx++];

            if(!target || !x || !y || !z) return line;

            // æ£€æŸ¥æ˜¯å¦æ˜¯detectæ¨¡å¼
            if(parts[idx] === 'detect') {
                // detectæ¨¡å¼ï¼š/execute ... detect <x> <y> <z> <block> <data> <command>
                idx++; // skip 'detect'
                const dx = parts[idx++];
                const dy = parts[idx++];
                const dz = parts[idx++];
                const block = parts[idx++];
                const data = parts[idx++];
                const command = parts.slice(idx).join(' ');

                // è½¬æ¢ä¸ºæ–°è¯­æ³•
                return `execute as ${target} at @s positioned ${x} ${y} ${z} if block ${dx} ${dy} ${dz} ${block} run ${command}`;
            } else {
                // æ™®é€šæ¨¡å¼
                const command = parts.slice(idx).join(' ');
                return `execute as ${target} at @s positioned ${x} ${y} ${z} run ${command}`;
            }
        } catch(e) {
            return `# é”™è¯¯ï¼šæ— æ³•è½¬æ¢ "${line}" - ${e.message}`;
        }
    }

    // åŸºå²©ç‰ˆè½¬æ¢ï¼ˆç®€åŒ–ç‰ˆï¼‰
    function convertBedrockExecute(line) {
        // åŸºå²©ç‰ˆæ–°æ—§è¯­æ³•å·®å¼‚è¾ƒå°ï¼Œä¸»è¦æ˜¯å‚æ•°ä½ç½®å˜åŒ–
        if(!line.trim().startsWith('/execute') && !line.trim().startsWith('execute')) return line;
        return line; // åŸºå²©ç‰ˆè½¬æ¢é€»è¾‘å¾…å®Œå–„
    }

    // ==================== è½¬æ¢åŠŸèƒ½ ====================
    function convertCommands(platform, source) {
        let input = '';
        if(source === 'mobile') {
            input = document.getElementById(`mobileInput-${platform}`).value;
        }

        if(!input.trim()) {
            showToast('è¯·è¾“å…¥éœ€è¦è½¬æ¢çš„æŒ‡ä»¤');
            return;
        }

        const lines = input.split('\n');
        const result = [];
        let converted = 0, errors = 0;

        lines.forEach(line => {
            const trimmed = line.trim();
            if(!trimmed || trimmed.startsWith('#')) {
                result.push(line);
                return;
            }

            let convertedLine;
            if(platform === 'java') {
                convertedLine = convertJavaExecute(line);
            } else {
                convertedLine = convertBedrockExecute(line);
            }

            if(convertedLine !== line) converted++;
            if(convertedLine.startsWith('# é”™è¯¯')) errors++;

            result.push(convertedLine);
        });

        converterState[platform] = {
            input: input,
            output: result.join('\n'),
            stats: { total: lines.length, converted, errors }
        };

        document.getElementById(`convertResult-${platform}`).innerHTML = renderConverterResult(platform);
        showToast(`âœ“ è½¬æ¢å®Œæˆï¼š${converted} è¡Œå·²æ›´æ–°`);
    }

    function clearConverter(platform) {
        converterState[platform] = { input: '', output: '', stats: { total: 0, converted: 0, errors: 0 } };
        const mobileInput = document.getElementById(`mobileInput-${platform}`);
        if(mobileInput) mobileInput.value = '';
        document.getElementById(`convertResult-${platform}`).innerHTML = '';
        showToast('å·²æ¸…ç©º');
    }

    function downloadResult(platform) {
        const state = converterState[platform];
        if(!state.output) return;

        const blob = new Blob([state.output], { type: 'text/plain;charset=utf-8' });
        const filename = `converted_${platform}_${new Date().getTime()}.mcfunction`;

        if(window.saveAs) {
            saveAs(blob, filename);
        } else {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        showToast('âœ“ ä¸‹è½½å·²å¼€å§‹');
    }

    // ==================== çº é”™åŠŸèƒ½ ====================
    function checkSyntax(platform, source) {
        let input = '';
        if(source === 'mobile') {
            input = document.getElementById(`fixInput-${platform}`).value;
        }

        if(!input.trim()) {
            showToast('è¯·è¾“å…¥éœ€è¦æ£€æµ‹çš„æŒ‡ä»¤');
            return;
        }

        const reports = [];
        const lines = input.split('\n');

        lines.forEach((line, idx) => {
            const trimmed = line.trim();
            if(!trimmed || trimmed.startsWith('#')) return;

            // æ ¹æ®å¹³å°æ‰§è¡Œä¸åŒæ£€æµ‹
            if(platform === 'java') {
                reports.push(...checkJavaSyntax(line, idx + 1));
            } else if(platform === 'bedrock') {
                reports.push(...checkBedrockSyntax(line, idx + 1));
            } else {
                reports.push(...checkNeteaseSyntax(line, idx + 1));
            }
        });

        fixerState[platform].input = input;
        fixerState[platform].reports = reports;

        document.getElementById(`fixResult-${platform}`).innerHTML = renderFixerResult(platform);

        if(reports.length === 0) {
            showToast('âœ“ æœªæ£€æµ‹åˆ°è¯­æ³•é”™è¯¯');
        } else {
            const critical = reports.filter(r => r.severity === 'critical').length;
            showToast(`æ£€æµ‹å®Œæˆï¼šå‘ç° ${critical} ä¸ªä¸¥é‡é”™è¯¯`);
        }
    }

    function autoFix(platform) {
        // è‡ªåŠ¨ä¿®å¤åŠŸèƒ½ - åŸºäºæ£€æµ‹æŠ¥å‘Šçš„ä¿®å¤
        const state = fixerState[platform];
        if(state.reports.length === 0) {
            showToast('è¯·å…ˆè¿›è¡Œæ£€æµ‹');
            return;
        }

        let input = state.input;
        const lines = input.split('\n');

        // ä»åå¾€å‰æ›¿æ¢ï¼Œé¿å…è¡Œå·å˜åŒ–
        const sortedReports = [...state.reports].sort((a, b) => b.line - a.line);

        sortedReports.forEach(report => {
            if(report.autoFixable && report.suggestion) {
                lines[report.line - 1] = report.suggestion;
            }
        });

        const fixed = lines.join('\n');
        state.input = fixed;

        // æ›´æ–°è¾“å…¥æ¡†
        const inputEl = document.getElementById(`fixInput-${platform}`);
        if(inputEl) inputEl.value = fixed;

        // é‡æ–°æ£€æµ‹
        checkSyntax(platform, 'mobile');
        showToast('âœ“ è‡ªåŠ¨ä¿®å¤å®Œæˆ');
    }

    function clearFixer(platform) {
        fixerState[platform] = { input: '', reports: [] };
        const inputEl = document.getElementById(`fixInput-${platform}`);
        if(inputEl) inputEl.value = '';
        document.getElementById(`fixResult-${platform}`).innerHTML = renderFixerPlaceholder(platform);
        showToast('å·²æ¸…ç©º');
    }

    // ==================== Javaç‰ˆè¯­æ³•æ£€æŸ¥ ====================
    function checkJavaSyntax(line, lineNum) {
        const reports = [];
        const trimmed = line.trim();

        // æ£€æŸ¥æ—§ç‰ˆexecute
        if((trimmed.startsWith('/execute') || trimmed.startsWith('execute')) && 
           !trimmed.includes(' as ') && !trimmed.includes(' at ') && !trimmed.includes(' run ')) {
            // å°è¯•è½¬æ¢çœ‹çœ‹æ˜¯å¦æˆåŠŸ
            const converted = convertJavaExecute(line);
            if(converted !== line) {
                reports.push({
                    line: lineNum,
                    severity: 'warning',
                    type: 'æ—§ç‰ˆexecuteè¯­æ³•',
                    original: line,
                    message: 'æ£€æµ‹åˆ°æ—§ç‰ˆexecuteè¯­æ³•ï¼ˆ1.12åŠä»¥å‰ï¼‰ï¼Œå»ºè®®è½¬æ¢ä¸ºæ–°è¯­æ³•',
                    suggestion: converted,
                    autoFixable: true,
                    docs: 'https://minecraft.wiki/w/Commands/execute'
                });
            }
        }

        // æ£€æŸ¥é€‰æ‹©å™¨è¯­æ³•
        if(trimmed.includes('@e[') && !trimmed.includes('limit=') && trimmed.includes('type=')) {
            reports.push({
                line: lineNum,
                severity: 'info',
                type: 'é€‰æ‹©å™¨ä¼˜åŒ–å»ºè®®',
                original: line,
                message: 'ä½¿ç”¨@eé€‰æ‹©å™¨æ—¶å»ºè®®æ·»åŠ limit=1ä»¥é¿å…é€‰ä¸­å¤šä¸ªå®ä½“',
                suggestion: line.replace('@e[', '@e[limit=1,'),
                autoFixable: true
            });
        }

        // æ£€æŸ¥NBTè¯­æ³•ï¼ˆç®€åŒ–æ£€æŸ¥ï¼‰
        if(trimmed.includes('{') && trimmed.includes('}')) {
            // æ£€æŸ¥å¼•å·
            if(trimmed.includes('CustomName:') && !trimmed.includes('CustomName:"')) {
                reports.push({
                    line: lineNum,
                    severity: 'critical',
                    type: 'NBTæ ¼å¼é”™è¯¯',
                    original: line,
                    message: 'CustomNameç­‰å­—ç¬¦ä¸²NBTæ ‡ç­¾éœ€è¦ä½¿ç”¨åŒå¼•å·åŒ…è£¹',
                    suggestion: line.replace(/CustomName:(\w+)/g, 'CustomName:"$1"'),
                    autoFixable: true,
                    docs: 'https://minecraft.wiki/w/NBT_format'
                });
            }
        }

        // æ£€æŸ¥ç‰©å“IDï¼ˆæ—§ç‰ˆæ•°å­—IDï¼‰
        if(/give\s+@\w+\s+\d+/.test(trimmed)) {
            reports.push({
                line: lineNum,
                severity: 'critical',
                type: 'å·²å¼ƒç”¨æ•°å­—ID',
                original: line,
                message: '1.13+ç‰ˆæœ¬ä¸å†æ”¯æŒæ•°å­—ç‰©å“IDï¼Œè¯·ä½¿ç”¨ç‰©å“è‹±æ–‡ID',
                suggestion: line.replace(/give\s+(@\w+)\s+(\d+)/, 'give $1 minecraft:stone /* è¯·æ›¿æ¢ä¸ºæ­£ç¡®ID */'),
                autoFixable: false,
                docs: 'https://minecraft.wiki/w/Java_Edition_1.13/Flattening'
            });
        }

        // æ£€æŸ¥æ–¹å—IDï¼ˆæ—§ç‰ˆï¼‰
        if(/setblock|fill|clone/.test(trimmed) && /\d+\s*\d*\s*\d*/.test(trimmed)) {
            // ç®€åŒ–æ£€æµ‹ï¼Œå®é™…éœ€è¦æ›´å¤æ‚çš„è§£æ
        }

        return reports;
    }

    // ==================== åŸºå²©ç‰ˆè¯­æ³•æ£€æŸ¥ ====================
    function checkBedrockSyntax(line, lineNum) {
        const reports = [];
        const trimmed = line.trim();

        // åŸºç¡€æ¨¡æ¿æ£€æµ‹
        if(!trimmed.startsWith('/') && !trimmed.startsWith('#') && trimmed.length > 0) {
            reports.push({
                line: lineNum,
                severity: 'warning',
                type: 'ç¼ºå°‘å‰å¯¼/',
                original: line,
                message: 'åŸºå²©ç‰ˆæŒ‡ä»¤é€šå¸¸éœ€è¦ä»¥/å¼€å¤´ï¼ˆå‘½ä»¤æ–¹å—å†…å¯çœç•¥ï¼‰',
                suggestion: '/' + line,
                autoFixable: true
            });
        }

        return reports;
    }

    // ==================== ç½‘æ˜“ç‰ˆè¯­æ³•æ£€æŸ¥ ====================
    function checkNeteaseSyntax(line, lineNum) {
        // åŸºäºåŸºå²©ç‰ˆï¼ŒåŠ ä¸Šç½‘æ˜“ç‰¹æœ‰åŠŸèƒ½
        const reports = checkBedrockSyntax(line, lineNum);

        // æ£€æµ‹ä¸­æ–‡ç‰©å“åï¼ˆç½‘æ˜“ç‰ˆæ”¯æŒä½†å»ºè®®ç”¨è‹±æ–‡ï¼‰
        const chineseItemPattern = /give\s+@\w+\s+[\u4e00-\u9fa5]+/;
        if(chineseItemPattern.test(line)) {
            reports.push({
                line: lineNum,
                severity: 'info',
                type: 'ä¸­æ–‡IDå»ºè®®',
                original: line,
                message: 'ç½‘æ˜“ç‰ˆæ”¯æŒä¸­æ–‡ç‰©å“åï¼Œä½†ä¸ºå…¼å®¹æ€§å»ºè®®ä½¿ç”¨è‹±æ–‡ID',
                suggestion: '/* è¯·å°†ä¸­æ–‡ç‰©å“åæ›¿æ¢ä¸ºè‹±æ–‡ID */ ' + line,
                autoFixable: false
            });
        }

        return reports;
    }

    // ==================== æ‹–æ”¾å¤„ç† ====================
    function setupConverterDragDrop(platform) {
        const dropZone = document.getElementById(`convertDropZone-${platform}`);
        const fileInput = document.getElementById(`convertFile-${platform}`);

        if(!dropZone || !fileInput) return;

        dropZone.onclick = () => fileInput.click();

        fileInput.onchange = async (e) => {
            await handleConvertFiles(e.target.files, platform);
        };

        dropZone.ondragover = (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        };
        dropZone.ondragleave = () => dropZone.classList.remove('dragover');
        dropZone.ondrop = async (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            await handleConvertFiles(e.dataTransfer.files, platform);
        };
    }

    function setupFixerDragDrop(platform) {
        const dropZone = document.getElementById(`fixDropZone-${platform}`);
        const fileInput = document.getElementById(`fixFile-${platform}`);

        if(!dropZone || !fileInput) return;

        dropZone.onclick = () => fileInput.click();

        fileInput.onchange = async (e) => {
            await handleFixFiles(e.target.files, platform);
        };

        dropZone.ondragover = (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        };
        dropZone.ondragleave = () => dropZone.classList.remove('dragover');
        dropZone.ondrop = async (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            await handleFixFiles(e.dataTransfer.files, platform);
        };
    }

    async function handleConvertFiles(files, platform) {
        let allContent = '';

        for(const file of files) {
            try {
                if(file.name.endsWith('.zip')) {
                    const zip = await JSZip.loadAsync(file);
                    for(const [name, zipFile] of Object.entries(zip.files)) {
                        if(name.endsWith('.txt') || name.endsWith('.mcfunction')) {
                            const content = await zipFile.async('text');
                            allContent += `\n# === ${name} ===\n` + content;
                        }
                    }
                } else {
                    const content = await file.text();
                    allContent += `\n# === ${file.name} ===\n` + content;
                }
            } catch(err) {
                console.error('è¯»å–æ–‡ä»¶å¤±è´¥:', err);
            }
        }

        if(allContent) {
            converterState[platform].input = allContent.trim();
            // æ›´æ–°ç§»åŠ¨ç«¯è¾“å…¥æ¡†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const mobileInput = document.getElementById(`mobileInput-${platform}`);
            if(mobileInput) mobileInput.value = allContent.trim();

            convertCommands(platform, 'mobile');
            showToast(`âœ“ å·²å¤„ç† ${files.length} ä¸ªæ–‡ä»¶`);
        }
    }

    async function handleFixFiles(files, platform) {
        let allContent = '';

        for(const file of files) {
            try {
                if(file.name.endsWith('.zip')) {
                    const zip = await JSZip.loadAsync(file);
                    for(const [name, zipFile] of Object.entries(zip.files)) {
                        if(name.endsWith('.txt') || name.endsWith('.mcfunction')) {
                            const content = await zipFile.async('text');
                            allContent += `\n# === ${name} ===\n` + content;
                        }
                    }
                } else {
                    const content = await file.text();
                    allContent += `\n# === ${file.name} ===\n` + content;
                }
            } catch(err) {
                console.error('è¯»å–æ–‡ä»¶å¤±è´¥:', err);
            }
        }

        if(allContent) {
            fixerState[platform].input = allContent.trim();
            // æ›´æ–°ç§»åŠ¨ç«¯è¾“å…¥æ¡†
            const inputEl = document.getElementById(`fixInput-${platform}`);
            if(inputEl) inputEl.value = allContent.trim();

            checkSyntax(platform, 'mobile');
            showToast(`âœ“ å·²åˆ†æ ${files.length} ä¸ªæ–‡ä»¶`);
        }
    }

    // ==================== åŸæœ‰æ•°æ®å¤„ç†åŠŸèƒ½ ====================
    function setupDragDrop() {
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        if(!dropZone || !fileInput) return;

        fileInput.onchange = async (e) => {
            await handleDatabaseFiles(e.target.files);
        };

        dropZone.ondragover = (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--mc-green)';
        };
        dropZone.ondragleave = () => {
            dropZone.style.borderColor = 'rgba(93,140,58,0.3)';
        };
        dropZone.ondrop = async (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'rgba(93,140,58,0.3)';
            await handleDatabaseFiles(e.dataTransfer.files);
        };
    }

    async function handleDatabaseFiles(files) {
        let newCount = 0;
        for(const file of files) {
            const fid = `${file.name}_${file.size}`;
            if(processedFiles.has(fid)) continue;
            processedFiles.add(fid);
            newCount++;

            try {
                if(file.name.endsWith('.zip')) {
                    const zip = await JSZip.loadAsync(file);
                    for(const [name, zipFile] of Object.entries(zip.files)) {
                        if(name.endsWith('.txt')) {
                            const content = await zipFile.async('text');
                            processContent(content, name);
                        }
                    }
                } else {
                    const text = await file.text();
                    processContent(text, file.name);
                }
            } catch(err) { console.error(err); }
        }

        if(newCount > 0) {
            saveToStorage();
            showToast(`âœ“ æˆåŠŸå¯¼å…¥ ${newCount} ä¸ªæ–‡ä»¶`);
            updateStats();
            updateFilters();
            renderContent();
        }
    }

    // è§£æå‡½æ•°ï¼ˆåŸæœ‰ï¼‰
    function cleanText(text) {
        if(!text) return '';
        return text.replace(/ã€|ã€‘/g, '').replace(/\[/g, '').replace(/\]/g, '')
            .replace(/[ï¼ˆ(].*?[)ï¼‰]/g, '').replace(/^\s*[-â€“â€”]\s*/g, '').trim();
    }

    function extractVersionRange(text) {
        if(!text) return null;
        const patterns = [
            /(\d+\.\d+(?:\.\d+)?)\s*[-~]\s*(\d+\.\d+(?:\.\d+)?)/,
            /(\d+\.\d+(?:\.\d+)?)\s*\+/,
            /(?:Java|BE|Edu|ç½‘æ˜“ç‰ˆ)\s*(\d+\.\d+(?:\.\d+)?)/i
        ];
        for(let pattern of patterns) {
            const match = text.match(pattern);
            if(match) {
                if(match[2]) return { min: match[1], max: match[2] };
                else return { min: match[1], max: '+' };
            }
        }
        return null;
    }

    function parseItems(text) {
        const items = [];
        const entries = text.split(/(?=ã€)/);
        for(const entry of entries) {
            if(!entry.includes('ã€')) continue;
            const lines = entry.trim().split('\n');
            let item = {};
            for(const line of lines) {
                if(line.includes('ã€') && line.includes('ã€‘')) item.name = cleanText(line);
                else if(line.includes('ID')) item.id = cleanText(line.split(/[ï¼š:]/)[1] || '');
                else if(line.includes('åˆ†ç±»')) item.category = cleanText(line.split(/[ï¼š:]/)[1] || '');
                else if(line.includes('ç®€ä»‹')) item.desc = cleanText(line.split(/[ï¼š:]/)[1] || '');
            }
            if(item.name) items.push(item);
        }
        return items;
    }

    function parseCommands(text, source) {
        const lines = text.split('\n');
        let current = null;
        for(let i = 0; i < lines.length; i++) {
            const line = lines[i];
            const trimmed = line.trim();
            if(!trimmed || trimmed.startsWith('â€”')) continue;

            if(trimmed.startsWith('/') && !trimmed.includes('ï¼š') && !line.includes(':')) {
                if(current && current.name) {
                    const key = `${current.name}_${source}`;
                    if(!data.commands.has(key)) data.commands.set(key, current);
                }
                current = {
                    name: cleanText(trimmed.split(/\s+/)[0]),
                    desc: '',
                    syntax: cleanText(trimmed),
                    usage: '',
                    source: source,
                    versionRange: { min: '', max: '' },
                    examples: []
                };
            } else if(current) {
                if(trimmed.startsWith('ç®€ä»‹')) current.desc = cleanText(trimmed.substring(3));
                else if(trimmed.startsWith('è¯­æ³•')) current.syntax = cleanText(trimmed.substring(3));
                else if(trimmed.startsWith('ç”¨é€”')) current.usage = cleanText(trimmed.substring(3));
                else if(trimmed.startsWith('é€‚ç”¨ç‰ˆæœ¬')) {
                    const verText = trimmed.substring(5);
                    const range = extractVersionRange(verText);
                    if(range) current.versionRange = range;
                }
                else if(trimmed.startsWith('>')) current.examples.push(cleanText(trimmed.substring(1)));
            }
        }
        if(current && current.name) {
            const key = `${current.name}_${source}`;
            if(!data.commands.has(key)) data.commands.set(key, current);
        }
    }

    function parseBlocks(text) {
        const blocks = [];
        const entries = text.split(/(?=ã€)/);
        for(const entry of entries) {
            if(!entry.includes('ã€')) continue;
            const lines = entry.trim().split('\n');
            let block = { obtains: [], ui: [], tips: [], type: '' };
            for(const line of lines) {
                if(line.includes('ã€') && line.includes('ã€‘')) block.name = cleanText(line);
                else if(line.includes('ç±»å‹')) block.type = cleanText(line.split(/[ï¼š:]/)[1] || '');
                else if(line.includes('åŠŸèƒ½')) block.desc = cleanText(line.split(/[ï¼š:]/)[1] || '');
                else if(line.includes('æŠ€å·§')) block.tips.push(cleanText(line.split(/[ï¼š:]/)[1] || ''));
            }
            if(block.name) blocks.push(block);
        }
        return blocks;
    }

    function parseRedstone(text) {
        const items = [];
        const entries = text.split(/(?=ã€)/);
        for(const entry of entries) {
            if(!entry.includes('ã€')) continue;
            const lines = entry.trim().split('\n');
            let item = { features: [], type: '' };
            for(const line of lines) {
                if(line.includes('ã€') && line.includes('ã€‘')) item.name = cleanText(line);
                else if(line.includes('ç±»å‹')) item.type = cleanText(line.split(/[ï¼š:]/)[1] || '');
                else if(line.includes('åŠŸèƒ½')) item.desc = cleanText(line.split(/[ï¼š:]/)[1] || '');
                else if(line.includes('ç‰¹æ€§')) item.features.push(cleanText(line.split(/[ï¼š:]/)[1] || ''));
            }
            if(item.name) items.push(item);
        }
        return items;
    }

    function parseAdvancements(text) {
        const advs = [];
        const lines = text.split('\n');
        let current = null;
        for(const line of lines) {
            const trimmed = line.trim();
            if(trimmed.startsWith('ã€') && trimmed.includes('ã€‘')) {
                if(current && current.id) advs.push(current);
                current = { name: cleanText(trimmed), category: '', id: '', desc: '', condition: '' };
            } else if(current && trimmed.includes('ID')) {
                current.id = cleanText(trimmed.split(/[ï¼š:]/)[1] || '');
            } else if(current && trimmed.includes('åˆ†ç±»')) {
                const cat = cleanText(trimmed.split(/[ï¼š:]/)[1] || '');
                current.category = categoryMap[cat] || cat;
            } else if(current && trimmed.includes('ç®€ä»‹')) {
                current.desc = cleanText(trimmed.split(/[ï¼š:]/)[1] || '');
            } else if(current && trimmed.includes('æ¡ä»¶')) {
                current.condition = cleanText(trimmed.split(/[ï¼š:]/)[1] || '');
            } else if(current && trimmed.includes('ç‰ˆæœ¬')) {
                const verText = trimmed.split(/[ï¼š:]/)[1] || '';
                const range = extractVersionRange(verText);
                if(range) current.versionRange = range;
            }
        }
        if(current && current.id) advs.push(current);
        return advs;
    }

    function processContent(text, filename) {
        const lower = filename.toLowerCase();
        if(lower.includes('item')) data.items.push(...parseItems(text));
        else if(lower.includes('redstone')) data.redstone.push(...parseRedstone(text));
        else if(lower.includes('block')) data.blocks.push(...parseBlocks(text));
        else if(lower.includes('advancement')) data.advancements.push(...parseAdvancements(text));
        else {
            let source = 'unknown';
            if(lower.includes('java')) source = 'java';
            else if(lower.includes('bedrock')) source = 'bedrock';
            else if(lower.includes('edu')) source = 'education';
            else if(lower.includes('netease')) source = 'netease';
            parseCommands(text, source);
        }
    }

    function selectFiles() {
        const input = document.getElementById('fileInput');
        if(input) input.click();
    }

    function clearAllData() {
        if(!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) return;

        data.commands.clear();
        data.blocks = [];
        data.redstone = [];
        data.items = [];
        data.advancements = [];
        processedFiles.clear();
        localStorage.removeItem(STORAGE_KEY);

        updateStats();
        updateFilters();
        renderContent();
        showToast('âœ“ å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®');
    }

    function renderContent() {
        const keyword = (document.getElementById('searchInput')?.value || '').toLowerCase();
        const container = document.getElementById('mainContent');
        if(!container) return;

        let html = '';
        switch(currentTab) {
            case 'commands':
                const cmds = Array.from(data.commands.values()).filter(c => {
                    if(currentFilter !== 'all' && c.source !== currentFilter) return false;
                    return !keyword || c.name.includes(keyword) || c.desc.toLowerCase().includes(keyword);
                });
                html = cmds.map(c => {
                    const versionText = c.versionRange.min ? `${c.versionRange.min}${c.versionRange.max === '+' ? '+' : '~' + c.versionRange.max}` : '';
                    return `
                    <div class="card card-cmd" onclick="showDetail('cmd', '${c.name}', '${c.source}')">
                        <div class="card-header">
                            <div>
                                <div class="card-title" style="color: var(--mc-green);">${c.name}</div>
                                ${versionText ? `<div class="version-range"><i class="fas fa-code-branch"></i> ${versionText}</div>` : ''}
                            </div>
                            <span class="tag">${versionMap[c.source] || c.source}</span>
                        </div>
                        <div class="card-desc">${c.desc || 'æš‚æ— ç®€ä»‹'}</div>
                    </div>`;
                }).join('');
                break;

            case 'blocks':
                const blocks = data.blocks.filter(b => {
                    if(currentFilter !== 'all' && !b.type.includes(currentFilter)) return false;
                    return !keyword || b.name.toLowerCase().includes(keyword);
                });
                html = blocks.map(b => `
                    <div class="card card-block" onclick="showDetail('block', '${b.name}')">
                        <div style="margin-bottom: 8px;">
                            <span class="tag tag-orange">${b.type || 'æ–¹å—'}</span>
                        </div>
                        <div class="card-title" style="color: var(--mc-orange);">${b.name}</div>
                        <div class="card-desc">${b.desc || ''}</div>
                    </div>
                `).join('');
                break;

            case 'redstone':
                const reds = data.redstone.filter(r => {
                    if(currentFilter !== 'all') return r.type && r.type.includes(currentFilter);
                    return !keyword || r.name.toLowerCase().includes(keyword);
                });
                html = reds.map(r => `
                    <div class="card card-redstone" onclick="showDetail('redstone', '${r.name}')">
                        ${r.type ? `<div style="margin-bottom: 8px;"><span class="tag tag-red">${r.type}</span></div>` : ''}
                        <div class="card-title" style="color: var(--mc-red);">${r.name}</div>
                        <div class="card-desc">${r.desc || ''}</div>
                    </div>
                `).join('');
                break;

            case 'items':
                const items = data.items.filter(i => {
                    if(currentFilter !== 'all' && i.category !== currentFilter) return false;
                    return !keyword || i.name.toLowerCase().includes(keyword) || i.id.toLowerCase().includes(keyword);
                });
                html = items.map(i => `
                    <div class="card card-item">
                        <div style="margin-bottom: 8px;">
                            <span class="tag tag-blue">${i.category || 'ç‰©å“'}</span>
                        </div>
                        <div class="card-title" style="color: #60a5fa;">${i.name}</div>
                        <div class="id-block" onclick="event.stopPropagation(); copyText('${i.id}')">${i.id}</div>
                        <div class="card-desc" style="margin-top: 8px;">${i.desc || ''}</div>
                    </div>
                `).join('');
                break;

            case 'advancements':
                const advs = data.advancements.filter(a => {
                    if(currentFilter !== 'all' && a.category !== currentFilter) return false;
                    return !keyword || a.id.toLowerCase().includes(keyword) || a.name.toLowerCase().includes(keyword);
                });
                html = advs.map(a => {
                    let catClass = 'cat-main';
                    if(a.category.includes('ä¸‹ç•Œ')) catClass = 'cat-nether';
                    else if(a.category.includes('æœ«åœ°')) catClass = 'cat-end';
                    else if(a.category.includes('å†’é™©')) catClass = 'cat-adventure';
                    else if(a.category.includes('å†œç‰§')) catClass = 'cat-husbandry';

                    return `
                    <div class="card card-adv" onclick="showDetail('adv', '${a.id}')">
                        <div class="card-header">
                            <div>
                                <span class="category-tag ${catClass}">${a.category || 'å‡†åˆ™'}</span>
                                <div class="card-title" style="color: var(--mc-cyan); margin-top: 4px;">${a.name}</div>
                            </div>
                        </div>
                        <div class="id-block" onclick="event.stopPropagation(); copyText('${a.id}')">${a.id}</div>
                        <div class="card-desc" style="margin-top: 8px;">${a.desc || ''}</div>
                        ${a.condition ? `<div style="margin-top: 8px; font-size: 0.8rem; color: #64748b;"><i class="fas fa-check-circle" style="color: var(--mc-green);"></i> ${a.condition}</div>` : ''}
                    </div>`;
                }).join('');
                break;
        }

        if(html === '') {
            html = `
                <div class="empty-state">
                    <div style="font-size: 4rem; margin-bottom: 16px;">ğŸ”</div>
                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 8px;">æœªæ‰¾åˆ°æ•°æ®</div>
                    <div style="font-size: 0.9rem; color: #64748b;">è¯·ä¸Šä¼ æ–‡ä»¶æˆ–æ›´æ”¹æœç´¢æ¡ä»¶</div>
                </div>`;
        }

        container.innerHTML = html;
    }

    function updateFilters() {
        const container = document.getElementById('filters');
        if(!container) return;

        let html = '<div class="chip active" onclick="setFilter(all)">å…¨éƒ¨</div>';

        if(currentTab === 'commands') {
            const versions = {};
            data.commands.forEach(c => { versions[c.source] = (versions[c.source] || 0) + 1; });
            Object.entries(versions).forEach(([v, n]) => {
                if(v !== 'unknown') html += `<div class="chip" onclick="setFilter('${v}')">${versionMap[v] || v} (${n})</div>`;
            });
        } else if(currentTab === 'blocks') {
            html += `<div class="chip" onclick="setFilter('è„‰å†²å‹')">è„‰å†²å‹</div>`;
            html += `<div class="chip" onclick="setFilter('å¾ªç¯å‹')">å¾ªç¯å‹</div>`;
            html += `<div class="chip" onclick="setFilter('è¿é”å‹')">è¿é”å‹</div>`;
        } else if(currentTab === 'redstone') {
            const types = new Set();
            data.redstone.forEach(r => {
                if(r.type) r.type.split(/[\/,]/).forEach(t => types.add(t.trim()));
            });
            types.forEach(t => { if(t) html += `<div class="chip" onclick="setFilter('${t}')">${t}</div>`; });
        } else if(currentTab === 'items') {
            const cats = {};
            data.items.forEach(i => { if(i.category) cats[i.category] = (cats[i.category] || 0) + 1; });
            Object.entries(cats).forEach(([c, n]) => { html += `<div class="chip" onclick="setFilter('${c}')">${c} (${n})</div>`; });
        } else if(currentTab === 'advancements') {
            const cats = {};
            data.advancements.forEach(a => { if(a.category) cats[a.category] = (cats[a.category] || 0) + 1; });
            Object.entries(cats).forEach(([c, n]) => { html += `<div class="chip" onclick="setFilter('${c}')">${c} (${n})</div>`; });
        }

        container.innerHTML = html;
    }

    function setFilter(filter) {
        currentFilter = filter;
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        if(event && event.target) event.target.classList.add('active');
        renderContent();
    }

    function handleSearch() {
        renderContent();
    }

    function showDetail(type, id, source) {
        const modal = document.getElementById('modal');
        const body = document.getElementById('modal-body');
        let content = '';

        if(type === 'cmd') {
            const cmd = Array.from(data.commands.values()).find(c => c.name === id && c.source === source);
            const versionText = cmd.versionRange.min ? `${cmd.versionRange.min}${cmd.versionRange.max === '+' ? '+' : '~' + cmd.versionRange.max}` : '';
            content = `
                <h2 style="font-family: VT323, monospace; font-size: 2.5rem; color: var(--mc-green); margin-bottom: 24px;">${cmd.name}</h2>
                <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <span style="background: rgba(93,140,58,0.2); color: var(--mc-light-green); padding: 6px 12px; border-radius: 8px; font-size: 0.9rem;">${versionMap[cmd.source] || cmd.source}</span>
                    ${versionText ? `<span style="background: rgba(251,191,36,0.2); color: var(--mc-gold); padding: 6px 12px; border-radius: 8px; font-size: 0.9rem;"><i class="fas fa-code-branch"></i> ${versionText}</span>` : ''}
                </div>
                <div style="margin-bottom: 20px;">
                    <div style="color: #64748b; font-size: 0.9rem; margin-bottom: 8px;">ç®€ä»‹</div>
                    <div style="line-height: 1.6;">${cmd.desc || 'æš‚æ— '}</div>
                </div>
                <div style="margin-bottom: 20px;">
                    <div style="color: #64748b; font-size: 0.9rem; margin-bottom: 8px;">è¯­æ³•</div>
                    <div style="background: rgba(0,0,0,0.4); padding: 16px; border-radius: 10px; font-family: JetBrains Mono, monospace; color: var(--mc-gold); border: 1px solid rgba(251,191,36,0.2);">${cmd.syntax}</div>
                </div>
                ${cmd.examples.length ? `
                    <div>
                        <div style="color: #64748b; font-size: 0.9rem; margin-bottom: 8px;">ç¤ºä¾‹</div>
                        ${cmd.examples.map(e => `<div style="background: rgba(93,140,58,0.1); padding: 12px; border-radius: 8px; margin-bottom: 8px; font-family: JetBrains Mono, monospace; cursor: pointer;" onclick="copyText('${e}')">${e}</div>`).join('')}
                    </div>
                ` : ''}
            `;
        } else if(type === 'adv') {
            const adv = data.advancements.find(a => a.id === id);
            let catClass = 'cat-main';
            if(adv.category.includes('ä¸‹ç•Œ')) catClass = 'cat-nether';
            else if(adv.category.includes('æœ«åœ°')) catClass = 'cat-end';
            else if(adv.category.includes('å†’é™©')) catClass = 'cat-adventure';
            else if(adv.category.includes('å†œç‰§')) catClass = 'cat-husbandry';

            content = `
                <h2 style="font-family: VT323, monospace; font-size: 2.5rem; color: var(--mc-cyan); margin-bottom: 16px;">${adv.name}</h2>
                <div style="margin-bottom: 16px;">
                    <span class="category-tag ${catClass}">${adv.category || 'å‡†åˆ™'}</span>
                </div>
                <div style="background: rgba(0,0,0,0.4); padding: 16px; border-radius: 10px; font-family: JetBrains Mono, monospace; color: var(--mc-cyan); margin-bottom: 24px; cursor: pointer;" onclick="copyText('${adv.id}')">${adv.id}</div>
                <div style="margin-bottom: 16px;"><span style="color: #64748b;">ç®€ä»‹:</span> ${adv.desc || 'æš‚æ— '}</div>
                ${adv.condition ? `<div style="margin-bottom: 16px;"><span style="color: #64748b;">æ¡ä»¶:</span> ${adv.condition}</div>` : ''}
            `;
        } else if(type === 'redstone') {
            const rs = data.redstone.find(r => r.name === id);
            content = `
                <h2 style="font-family: VT323, monospace; font-size: 2.5rem; color: var(--mc-red); margin-bottom: 16px;">${rs.name}</h2>
                ${rs.type ? `<div style="margin-bottom: 16px;"><span class="tag tag-red">${rs.type}</span></div>` : ''}
                <div style="margin-bottom: 16px;"><span style="color: #64748b;">åŠŸèƒ½:</span> ${rs.desc || 'æš‚æ— '}</div>
                ${rs.features.length ? `
                    <div style="margin-bottom: 16px;">
                        <div style="color: #64748b; margin-bottom: 8px;">ç‰¹æ€§:</div>
                        ${rs.features.map(f => `<div style="padding: 8px; background: rgba(220,38,38,0.1); border-radius: 6px; margin-bottom: 6px;">${f}</div>`).join('')}
                    </div>
                ` : ''}
            `;
        }

        body.innerHTML = content;
        modal.style.display = 'block';
    }

    function closeModal(e) {
        if(!e || e.target.id === 'modal') {
            document.getElementById('modal').style.display = 'none';
        }
    }

    function copyText(text) {
        navigator.clipboard.writeText(text).then(() => showToast('âœ“ å·²å¤åˆ¶'));
    }

    function showToast(msg) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2500);
    }

    function updateStats() {
        document.getElementById('badge-cmd').textContent = data.commands.size;
        document.getElementById('badge-block').textContent = data.blocks.length;
        document.getElementById('badge-redstone').textContent = data.redstone.length;
        document.getElementById('badge-item').textContent = data.items.length;
        document.getElementById('badge-adv').textContent = data.advancements.length;

        const total = data.commands.size + data.blocks.length + data.redstone.length + data.items.length + data.advancements.length;
        document.getElementById('stat-total').textContent = total;
        document.getElementById('stat-cmd').textContent = data.commands.size;
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    </script>
</body>
</html>
